# LOGIC_01_META.yaml

meta:
  owner: "AI Opener"
  version: "2.0.0"
  last_updated: "2025-12-11"
  purpose: "Metadata standards and $ref validation rules (SSOT)"
  notes: "v2.0 - Complete ref validation with known valid targets"
  tags: [logic, meta, validation, ssot]

canonical_meta_template:
  fields:
    owner:
      type: "string"
      required: true
      validation: "non-empty"
    version:
      type: "string"
      required: true
      validation: "semver"
      pattern: "^\\d+\\.\\d+\\.\\d+$"
    last_updated:
      type: "date"
      required: true
      validation: "ISO8601"
      pattern: "^\\d{4}-\\d{2}-\\d{2}$"
    purpose:
      type: "string"
      required: true
      validation: "max_length: 100"
    notes:
      type: "string"
      required: false
      default: ""
    tags:
      type: "array"
      required: true
      items: "string"
      validation: "$ref: LOGIC_03_TAXONOMY#valid_tags"

  layer_extensions:
    CONFIG:
      - field: "environment"
        type: "enum"
        values: ["production", "staging", "development"]
        required: true
    CLIENT:
      - field: "client_id"
        type: "string"
        required: true
      - field: "client_name"
        type: "string"
        required: true
      - field: "tier"
        type: "enum"
        values: ["starter", "professional", "enterprise"]
        required: true
    PACKS:
      - field: "portability"
        type: "enum"
        values: ["portable", "org-specific", "client-specific"]
        required: true

ref_validation:
  syntax:
    pattern: "$ref: {FILE}#{PATH}"
    file_pattern: "{LAYER}_{NN}_{NAME}"
    path_separator: "."
  validation_rules:
    - rule: "FILE must exist in declared layer directory"
      on_failure: "error"
    - rule: "PATH must exist as key in FILE"
      on_failure: "error"
    - rule: "Nested paths use dot notation"
    - rule: "Self-references within same file use #path only"
  build_time_check:
    enabled: true
    action: "Parse all YAML files, extract $ref values, validate targets"
    on_failure: "block_startup"

known_valid_refs:
  LOGIC_00_INDEX: ["auto_inheritance", "boot_sequence", "layers", "override_strategy"]
  LOGIC_02_RETRIEVAL:
    - "base_dependencies_template"
    - "override_rules"
    - "override_rules.immutable_paths"
    - "override_rules.strategies"
    - "graceful_degradation_patterns"
    - "layer_degradation_templates"
    - "libraries_mechanics"
    - "version_management"
    - "common_validation_checklist"
  LOGIC_05_RAG_MECHANICS:
    - "vector_store"
    - "embedding_models"
    - "chunking"
    - "retrieval_pipeline"
    - "change_detection"
    - "libraries_retrieval"
  LOGIC_06_ORCHESTRATION:
    - "orchestration_modes"
    - "mode_selection_guidance"
    - "use_case_registry"
    - "simulation_mode"
    - "orchestrator_contract"
    - "library_discovery_step"
  LOGIC_08_QUALITY_GATES:
    - "universal_gates"
    - "evidence_tiers"
    - "source_reliability"
    - "evidence_item_schema"
    - "combined_assessment"
    - "libraries_gates"
    - "library_gap_report_schema"
  LOGIC_09_INTERFACE:
    - "output_standards"
    - "hitl_triggers"
  LOGIC_16_POLICY_CAPTURE:
    - "enforcement_actions"
    - "policy_evaluation"

structural_validation:
  yaml_syntax:
    enabled: true
    on_failure: "error"
  duplicate_keys:
    enabled: true
    on_failure: "error"
  required_sections:
    by_layer:
      CONFIG: ["meta", "activation", "instance"]
      DEMO: ["meta", "demo_mode", "presenter", "client"]
      LOGIC: ["meta"]
      OPS: ["meta"]
      ROLES: ["meta", "role_definition", "capabilities", "quality_gates"]
      PACKS: ["meta", "pack_definition", "knowledge_assets"]
      USE_CASES: ["meta", "use_case_definition", "capabilities_from", "quality_gates"]
      WORKFLOWS: ["meta", "workflow_definition", "phases", "quality_gates", "deliverables"]
      ORG: ["meta", "agency_identity", "defaults"]
      CLIENT: ["meta", "client_identity", "voice"]
