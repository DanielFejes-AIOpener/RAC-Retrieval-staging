# LOGIC_18_CASE_CAPTURE.yaml

meta:
  owner: "AI Opener"
  version: "2.0.0"
  last_updated: "2025-12-15"
  purpose: "Manual #case command, case-record schema, and chat-output rules (SSOT)"
  notes: "v2.0 - Chat-only case capture with no RAC persistence implied"
  tags: [logic, case, ssot]

command:
  name: "#case"
  type: "manual"
  invocation:
    trigger: "User types #case in chat"
    auto_trigger: false
  prerequisites:
    - condition: "Previous interaction was successful"
      validation: "Check last interaction status"
      on_failure: { action: "reject", message: "Cannot capture case: no successful interaction to capture. Complete a use case or workflow successfully first." }
    - condition: "Context available from last interaction"
      on_failure: { action: "reject", message: "Cannot capture case: no use case or workflow context found in this session." }

case_record_schema:
  auto_captured_fields:
    case_id: { type: "string", pattern: "case-{YYYYMMDD}-{HHmmss}-{nnn}" }
    captured_at: { type: "datetime", format: "ISO-8601" }
    source_type: { type: "enum", values: ["use_case", "workflow"] }
    source_id: { type: "string" }
    source_name: { type: "string" }
    client_id: { type: "string", nullable: true }
    inputs_summary: { type: "string", max_length: 500 }
    outputs_summary: { type: "string", max_length: 1000 }
    effort_estimated: { type: "object", properties: { hours_min: "number", hours_max: "number", source: "string" }, nullable: true }

  user_prompted_fields:
    impact_summary:
      type: "string"
      max_length: 500
      required: true
      prompt: "What business outcome did this achieve? (e.g., 'Reduced content creation time by 60%', 'Generated 12 qualified leads')"
    key_learning:
      type: "string"
      max_length: 500
      required: true
      prompt: "What worked well that you'd want to repeat? (e.g., 'The structured brief format', 'Using competitor analysis first')"
    actual_effort:
      type: "object"
      required: false
      prompt: "How long did this actually take? (optional, helps calibrate estimates)"
      properties: { hours: "number", notes: "string" }

  optional_fields:
    tags: { type: "array", items: "string", prompt: "Any tags to categorize this case? (optional)" }
    stakeholder_feedback: { type: "string", max_length: 300, prompt: "Any feedback from stakeholders? (optional)" }
    follow_up_opportunity: { type: "string", max_length: 300, prompt: "Any follow-up opportunities identified? (optional)" }

capture_flow:
  steps:
    1_validate:
      action: "Check prerequisites"
      checks: ["Last interaction was successful", "Context available (use_case_id or workflow_id)"]
      on_failure: "Return rejection message, do not proceed"
    2_auto_capture:
      action: "Extract auto-captured fields from session"
      source: "Last interaction context"
      fields: ["source_type", "source_id", "source_name", "client_id", "inputs_summary", "outputs_summary", "effort_estimated"]
    3_generate_metadata:
      action: "Generate case_id and captured_at"
    4_prompt_required:
      action: "Prompt user for required fields"
      fields: ["impact_summary", "key_learning"]
      format: "Ask one at a time, confirm each before proceeding"
    5_prompt_optional:
      action: "Offer optional fields"
      prompt: "Would you like to add any of the following? (respond with numbers or 'done')"
      options: { 1: "actual_effort", 2: "tags", 3: "stakeholder_feedback", 4: "follow_up_opportunity" }
      behavior: "Skip if user says 'done' or 'no'"
    6_assemble_record:
      action: "Combine all fields into case record"
    7_output_record:
      action: "Display formatted case record in chat"
      format: "$ref: #output_format"

output_format:
  presentation:
    style: "structured_markdown"
    note: "Chat-only output -- RAC runtime does not imply persistence"
  template: |
    ---
    ## Case Record: {case_id}
    
    **Captured:** {captured_at}
    **Source:** {source_name} ({source_type}: {source_id})
    {if client_id}**Client:** {client_id}{/if}
    
    ### Context
    **Inputs:** {inputs_summary}
    **Outputs:** {outputs_summary}
    
    ### Results
    **Impact:** {impact_summary}
    **Key Learning:** {key_learning}
    
    {if effort_estimated}
    ### Effort
    **Estimated:** {effort_estimated.hours_min}â€“{effort_estimated.hours_max} hours
    {if actual_effort}**Actual:** {actual_effort.hours} hours{if actual_effort.notes} ({actual_effort.notes}){/if}{/if}
    {/if}
    
    {if tags}**Tags:** {tags|join(", ")}{/if}
    {if stakeholder_feedback}**Stakeholder Feedback:** {stakeholder_feedback}{/if}
    {if follow_up_opportunity}**Follow-up:** {follow_up_opportunity}{/if}
    
    ---
    _This case record is displayed in chat only. Copy or export as needed._
  export_guidance:
    message: "To save this case, copy the record above. You can paste it into Notion, Gamma, or any documentation tool."

effort_comparison:
  reference: "$ref: LOGIC_15_EFFORT_ESTIMATION#baselines"
  calculation:
    variance: "(actual_hours - estimated_midpoint) / estimated_midpoint * 100"
    estimated_midpoint: "(effort_estimated.hours_min + effort_estimated.hours_max) / 2"
  interpretation:
    within_20_percent: "Estimate was accurate"
    underestimate_over_20: "Task took longer than expected -- consider adjusting baseline"
    overestimate_over_20: "Task completed faster -- AI assistance may be more effective for this type"
  display:
    show_when: "Both effort_estimated and actual_effort are present"
    format: "Include variance percentage and interpretation in output"

validation_rules:
  rules:
    - rule: "impact_summary is required and non-empty"
      on_violation: "Re-prompt user"
    - rule: "key_learning is required and non-empty"
      on_violation: "Re-prompt user"
    - rule: "source_id must match valid USE_CASE or WORKFLOW pattern"
      on_violation: "Log warning, proceed with available data"
    - rule: "actual_effort.hours must be positive number if provided"
      on_violation: "Reject value, re-prompt"
    - rule: "All string fields respect max_length"
      on_violation: "Truncate with '...' and warn user"

error_handling:
  scenarios:
    no_prior_interaction:
      condition: "Session has no completed use case or workflow"
      action: "Reject with clear message"
      message: "I don't have a completed use case or workflow to capture. Run a use case or workflow first, then use #case to record the results."
    incomplete_context:
      condition: "Some auto-captured fields unavailable"
      action: "Proceed with available fields, note gaps"
      message: "Some context is missing. I'll capture what's available."
    user_cancels:
      condition: "User says 'cancel' or 'nevermind' during prompts"
      action: "Abort capture gracefully"
      message: "Case capture cancelled. You can use #case again anytime after a successful interaction."
    session_timeout:
      condition: "User doesn't respond to prompts"
      action: "Do not auto-save partial records"

persistence:
  storage: "none"
  clarification:
    - "RAC runtime does not persist case records"
    - "Case records exist only in chat output"
    - "User is responsible for copying/exporting if they want to save"
    - "No database, no file system, no external storage implied"
  user_options: ["Copy markdown from chat", "Export to Notion, Gamma, Google Docs, etc.", "Screenshot for quick reference"]
  not_supported: ["Automatic saving to any system", "Retrieval of past cases", "Case record search or filtering", "Analytics on captured cases"]
