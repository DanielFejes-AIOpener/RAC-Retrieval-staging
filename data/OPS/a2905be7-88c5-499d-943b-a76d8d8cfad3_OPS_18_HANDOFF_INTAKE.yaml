# OPS_18_HANDOFF_INTAKE.yaml

meta:
  owner: "AI Opener"
  version: "2.0.0"
  last_updated: "2025-01-15"
  purpose: "Structured intake handoff contract for workflow phase transitions"
  notes: "Referenced by WORKFLOWS at phase boundaries; validates intake completeness"
  tags: [ops, handoff, intake, contract, workflow]

extends: "OPS_00_STANDARDS"
evidence_tiers: "$ref: LOGIC_08_QUALITY_GATES#evidence_tiers"
source_reliability: "$ref: LOGIC_08_QUALITY_GATES#source_reliability"
quality_gates: "$ref: LOGIC_08_QUALITY_GATES#universal_gates"

handoff_contract:
  type: "intake"
  version: "2.0"
  required_fields:
    - { field: "request_id", type: "string", format: "UUID", description: "Unique identifier for this request", generation: "auto", example: "550e8400-e29b-41d4-a716-446655440000" }
    - { field: "request_summary", type: "string", max_length: 500, description: "Brief summary of the request", example: "Create employer branding campaign for Q2 recruitment drive" }
    - field: "requester"
      type: "object"
      schema:
        name: { type: "string", required: true }
        role: { type: "string", required: true }
        contact: { type: "string", required: true, format: "email" }
        organization: { type: "string", required: false }
    - { field: "deliverable_type", type: "enum", values: ["brief", "strategy", "campaign", "content", "copy", "report", "analysis", "creative", "other"], description: "Primary type of deliverable expected" }
    - { field: "deadline", type: "datetime", format: "ISO8601", description: "When final deliverable is due", validation: "Must be in future", example: "2025-02-28T17:00:00Z" }
    - field: "priority"
      type: "enum"
      values:
        - { value: "low", description: "Flexible timeline, can be deprioritized", sla_multiplier: 1.5 }
        - { value: "normal", description: "Standard priority and timeline", sla_multiplier: 1.0 }
        - { value: "high", description: "Accelerated timeline, elevated attention", sla_multiplier: 0.75 }
        - { value: "urgent", description: "Immediate attention required", sla_multiplier: 0.5, requires_approval: true }
    - { field: "created_at", type: "datetime", format: "ISO8601", description: "When handoff was created", generation: "auto" }
    - field: "created_by"
      type: "object"
      schema:
        agent_id: { type: "string", required: true }
        role_id: { type: "string", required: false }
        use_case_id: { type: "string", required: false }

  optional_fields:
    - field: "context_documents"
      type: "array"
      items:
        type: "object"
        schema:
          document_id: { type: "string", required: true }
          document_name: { type: "string", required: true }
          document_type: { type: "enum", values: ["brief", "reference", "brand_guide", "data", "previous_work", "other"] }
          location: { type: "string", format: "uri", required: false }
    - field: "constraints"
      type: "object"
      schema:
        budget: { type: "object", schema: { amount: { type: "number" }, currency: { type: "string", default: "EUR" }, approved: { type: "boolean" } } }
        timeline_constraints: { type: "array", items: "string", description: "Specific timeline dependencies or blockers" }
        content_restrictions: { type: "array", items: "string", description: "Topics, claims, or approaches to avoid" }
        brand_requirements: { type: "array", items: "string", description: "Mandatory brand elements or guidelines" }
        regulatory: { type: "array", items: "string", description: "Regulatory requirements to comply with" }
    - { field: "success_criteria", type: "array", items: "string", description: "How success will be measured for this request", example: ["Campaign generates 50+ qualified leads", "Content achieves 5% engagement rate", "Deliverable approved within 2 review rounds"] }
    - field: "target_audience"
      type: "object"
      schema:
        description: { type: "string" }
        personas: { type: "array", items: "string" }
        geography: { type: "array", items: "string" }
        language: { type: "string" }
    - field: "evidence_requirements"
      type: "object"
      schema:
        minimum_tier: { type: "enum", values: ["tier_1", "tier_2", "tier_3"], default: "tier_2" }
        freshness_months: { type: "integer", default: 24 }
        citation_style: { type: "string", default: "inline" }
    - field: "approvals_obtained"
      type: "array"
      items:
        type: "object"
        schema: { approver_name: { type: "string" }, approver_role: { type: "string" }, approval_type: { type: "string" }, approved_at: { type: "datetime" } }
    - { field: "related_requests", type: "array", items: "string", format: "UUID", description: "IDs of related or dependent requests" }
    - { field: "notes", type: "string", max_length: 2000, description: "Additional context or special instructions" }

hash_verification:
  enabled: true
  algorithm: "SHA-256"
  implementation:
    field: "content_hash"
    computed_from: ["request_id", "request_summary", "requester", "deliverable_type", "deadline", "priority", "created_at"]
    purpose: "Ensures handoff integrity during transfer"
  verification_behavior:
    on_receive: [{ action: "Recompute hash from received fields" }, { action: "Compare with transmitted content_hash" }, { on_mismatch: { severity: "error", action: "Reject handoff, request retransmission" } }]
    on_modification: [{ action: "Recompute hash after any field change" }, { action: "Update content_hash" }, { action: "Log modification event" }]

validation_rules:
  on_receive:
    required_field_checks: ["All required fields present and non-empty", "Field types match schema", "Enum values are valid"]
    business_logic_checks:
      - { check: "deadline_in_future", rule: "deadline > current_timestamp", severity: "error", message: "Deadline must be in the future" }
      - { check: "requester_contact_valid", rule: "requester.contact matches email format", severity: "error", message: "Requester contact must be valid email" }
      - { check: "urgent_requires_approval", rule: "if priority == 'urgent' then approvals_obtained is non-empty", severity: "warning", message: "Urgent requests should have pre-approval documented" }
      - { check: "budget_if_campaign", rule: "if deliverable_type == 'campaign' then constraints.budget exists", severity: "warning", message: "Campaign requests should include budget information" }
    hash_verification: ["content_hash matches computed hash"]
  completeness_scoring:
    scoring: { required_fields: 60, optional_fields: { context_documents: 10, constraints: 10, success_criteria: 10, target_audience: 5, evidence_requirements: 5 } }
    thresholds: { minimum: 60, recommended: 80, complete: 95 }
    on_below_minimum: { severity: "error", action: "Block handoff, list missing required fields" }
    on_below_recommended: { severity: "warning", action: "Allow handoff, flag incomplete fields" }

workflow_integration:
  usage_pattern:
    at_phase_exit: ["Agent packages handoff according to this schema", "System validates against required_fields", "System computes and attaches content_hash"]
    at_phase_entry: ["System validates received handoff", "System verifies content_hash", "On validation pass: phase entry proceeds", "On validation fail: handoff rejected, error surfaced"]
  reference_pattern:
    in_workflow: |
      phases:
        - phase_id: "phase_1"
          handoff:
            to: "phase_2"
            contract: "$ref: OPS_18_HANDOFF_INTAKE"
  linking_to_delivery:
    description: "Intake handoff creates request_id used by delivery handoff"
    rule: "OPS_19 delivery.request_id must match OPS_18 intake.request_id"

validation:
  ops_18_specific:
    structural: ["handoff_contract.type == 'intake'", "All required_fields have type definitions", "All enum fields have explicit values list", "hash_verification section complete"]
    content: ["No procedural logic (how to collect or who collects)", "No client-specific fields (those extend via ORG/CLIENT)", "No workflow routing decisions (those belong in WORKFLOWS)"]
    schema_integrity: ["Field names are snake_case", "Required fields are minimal but sufficient", "Optional fields have sensible defaults where applicable"]
