# WORKFLOW_01_TRENDWATCHER_MORNING.yaml
# RAC 2.0 — Migrated from OPS_22_TRENDWATCHER_MORNING_WORKFLOW.yaml (RAC 1.0)

meta:
  owner: "AI Opener"
  version: "2.0.0"
  last_updated: "2025-01-06"
  purpose: "Paired-agent workflow for daily social media content production"
  notes: "Produces 9 social posts (3 topics × 3 formats) with visuals, delivered via 4 Slack messages"
  tags: [workflows, social-media, content-production, paired-agents]

# Extends: WORKFLOW_00_BASE_TEMPLATE
# Auto-inherited: base_dependencies per LOGIC_00_INDEX#auto_inheritance

# ═══════════════════════════════════════════════════════════════════════════════
# WORKFLOW-SPECIFIC REFERENCES
# ═══════════════════════════════════════════════════════════════════════════════

interface_standards_ref: "$ref: LOGIC_09_INTERFACE"
hitl_triggers_ref: "$ref: LOGIC_09_INTERFACE#hitl_triggers"
effort_estimation_ref: "$ref: LOGIC_15_EFFORT_ESTIMATION"
governance_ref: "$ref: LOGIC_12_GOVERNANCE"
ai_policy_enforcement: "$ref: LOGIC_16_POLICY_CAPTURE#enforcement_actions"

tool_registry_ref: "$ref: LOGIC_10_TOOLS_CORE#tool_registry"
capability_mapping_ref: "$ref: LOGIC_10_TOOLS_CORE#capability_tool_mapping"

# ═══════════════════════════════════════════════════════════════════════════════
# WORKFLOW DEFINITION
# ═══════════════════════════════════════════════════════════════════════════════

workflow_definition:
  workflow_id: "WORKFLOW_01_TRENDWATCHER_MORNING"
  name: "TrendWatcher Morning Posts Production"
  risk_level: "high"
  trace_required: true
  trace_fields:
    - "sources_consulted"
    - "guidance_applied"
    - "conflicts_resolved"
    - "decisions"
    - "policy_outcomes"
    - "quality_gate_results"

  execution_mode: "Paired-SAM"
  activation_model: "manual"
  output_type: "public-facing social media content"

  mission: |
    Orchestrate a 4-phase paired workflow to produce 9 social media posts 
    (3 topics × 3 formats) with accompanying visuals, delivered as 4 structured 
    Slack messages.

  deliverables:
    - "9 social media posts (3 topics × 3 formats)"
    - "9 platform-optimized images with accessibility metadata"
    - "4 structured Slack messages with complete content package"

# ═══════════════════════════════════════════════════════════════════════════════
# ROLE PAIRS (Capability-based, not agent-named)
# ═══════════════════════════════════════════════════════════════════════════════

role_pairs:
  pair_research_strategy:
    roles: ["ROLE_07_ANALYST", "ROLE_02_STRATEGIST"]
    focus: "Research and Strategic Selection"
    handoff_to: "pair_copy_visuals"

  pair_copy_visuals:
    roles: ["ROLE_04_COPYWRITER", "ROLE_05_DESIGNER"]
    focus: "Copy Creation and Visual Production"
    handoff_to: "ROLE_01_ORCHESTRATOR"

# ═══════════════════════════════════════════════════════════════════════════════
# STATE MANAGEMENT
# ═══════════════════════════════════════════════════════════════════════════════

state_management:
  checkpointing:
    enabled: true
    checkpoint_contents:
      - field: "workflow_id"
      - field: "current_phase"
      - field: "phase_history"
      - field: "context_snapshot"
      - field: "trace_context"
      - field: "work_doc_id"
  resume_policy: "resume_from_last_checkpoint"
  rollback_policy: "rollback_to_previous_checkpoint"

# ═══════════════════════════════════════════════════════════════════════════════
# PHASES
# ═══════════════════════════════════════════════════════════════════════════════

phases:

  # ─────────────────────────────────────────────────────────────────────────────
  # PHASE 1: INITIALIZATION
  # ─────────────────────────────────────────────────────────────────────────────
  - phase_id: "phase_1_initialization"
    description: "Create work document and delegate to research/strategy pair"

    entry_gate:
      conditions:
        - "Manual trigger received"
        - "Required tools available"
      policy_checks:
        - "$ref: LOGIC_16_POLICY_CAPTURE#enforcement_actions.validate_workflow_start"

    actions:
      - action_type: "invoke_tool"
        capability_key: "document_creation"
        params:
          doc_name_template: "TRENDWATCHER MORNING POSTS - {DATE}"
          sections:
            - "WORKFLOW STATUS"
            - "PHASE 1: RESEARCH & STRATEGY"
            - "PHASE 2: COPY & VISUALS"
            - "PHASE 3: COMPILATION"

      - action_type: "invoke_use_case"
        use_case_id: "USE_CASE_07_ANALYST"
        inputs:
          task: "research_pillars"
          pillars: ["TRENDS", "INDUSTRY", "REGULATIONS", "COMPETITORS"]
          items_per_pillar: 3
          output_location: "work_doc.phase_1.research"

      - action_type: "invoke_use_case"
        use_case_id: "USE_CASE_02_STRATEGIST"
        inputs:
          task: "strategic_selection"
          source: "work_doc.phase_1.research"
          topics_to_select: 3
          output_location: "work_doc.phase_1.strategy"

    exit_gate:
      conditions:
        - "Work document created successfully"
        - "Research/strategy pair activated"
        - "work_doc_id captured in state"
      policy_checks:
        - "$ref: LOGIC_16_POLICY_CAPTURE#enforcement_actions.validate_handoff"

    handoff:
      to: "phase_2_research_strategy"
      contract: "OPS_12_HANDOFF_CONTRACTS#paired_agent_handoff"
      context_pass:
        - "trace_context"
        - "work_doc_id"

  # ─────────────────────────────────────────────────────────────────────────────
  # PHASE 2: RESEARCH & STRATEGY
  # ─────────────────────────────────────────────────────────────────────────────
  - phase_id: "phase_2_research_strategy"
    description: "ANALYST + STRATEGIST pair collaborate on research and topic selection"

    entry_gate:
      conditions:
        - "Handoff from phase_1 received"
        - "work_doc_id available"
      policy_checks:
        - "$ref: LOGIC_16_POLICY_CAPTURE#enforcement_actions.validate_phase_entry"

    actions:
      - action_type: "invoke_tool"
        capability_key: "web_search"
        params:
          scope: "news_and_industry"

      - action_type: "invoke_tool"
        capability_key: "web_fetch"
        params:
          purpose: "source_verification"

      - action_type: "wait_for_signal"
        signal_id: "phase_2_complete"

    exit_gate:
      conditions:
        - "3 topics selected with complete strategic framing"
        - "All research items have evidence tier + source URL"
        - "PHASE 1 STATUS marked Complete in work_doc"
      policy_checks:
        - "$ref: LOGIC_16_POLICY_CAPTURE#enforcement_actions.validate_research_output"
        - "$ref: LOGIC_16_POLICY_CAPTURE#enforcement_actions.validate_handoff"

    handoff:
      to: "phase_3_copy_visuals"
      contract: "OPS_12_HANDOFF_CONTRACTS#paired_agent_handoff"
      context_pass:
        - "trace_context"
        - "work_doc_id"
        - "selected_topics"

  # ─────────────────────────────────────────────────────────────────────────────
  # PHASE 3: COPY & VISUALS
  # ─────────────────────────────────────────────────────────────────────────────
  - phase_id: "phase_3_copy_visuals"
    description: "COPYWRITER + DESIGNER pair create posts and visuals"

    entry_gate:
      conditions:
        - "Handoff from phase_2 received"
        - "3 topics with strategic framing available"
      policy_checks:
        - "$ref: LOGIC_16_POLICY_CAPTURE#enforcement_actions.validate_phase_entry"

    actions:
      - action_type: "invoke_use_case"
        use_case_id: "USE_CASE_04_COPYWRITER"
        inputs:
          task: "create_posts"
          formats:
            - format_id: "linkedin_thought_leadership"
              length: "150-250 words"
              voice: "personal, authoritative"
            - format_id: "linkedin_company"
              length: "100-180 words"
              voice: "professional, solution-oriented"
            - format_id: "twitter"
              length: "max 280 chars"
              voice: "punchy, conversational"
          topics_count: 3
          output_location: "work_doc.phase_2.copy"

      - action_type: "invoke_use_case"
        use_case_id: "USE_CASE_05_DESIGNER"
        inputs:
          task: "create_visuals"
          images_count: 9
          specs:
            linkedin_thought_leadership: "1200x627px"
            linkedin_company: "1200x1200px"
            twitter: "1200x628px"
          requirements:
            - "WCAG AA compliance"
            - "Brand guidelines v2.1"
            - "Alt text required"
            - "AI disclosure required"
          output_location: "work_doc.phase_2.visuals"

      - action_type: "wait_for_signal"
        signal_id: "phase_3_complete"

    exit_gate:
      conditions:
        - "9 posts created with voice audits (all PASS)"
        - "9 images created with compliance checks (all PASS)"
        - "No placeholder text remains"
        - "PHASE 2 STATUS marked Complete in work_doc"
      policy_checks:
        - "$ref: LOGIC_16_POLICY_CAPTURE#enforcement_actions.validate_content_output"
        - "$ref: LOGIC_16_POLICY_CAPTURE#enforcement_actions.validate_external_communication"

    handoff:
      to: "phase_4_compilation"
      contract: "OPS_12_HANDOFF_CONTRACTS#final_delivery_handoff"
      context_pass:
        - "trace_context"
        - "work_doc_id"

  # ─────────────────────────────────────────────────────────────────────────────
  # PHASE 4: COMPILATION & DELIVERY
  # ─────────────────────────────────────────────────────────────────────────────
  - phase_id: "phase_4_compilation"
    description: "ORCHESTRATOR compiles outputs and delivers via Slack"

    entry_gate:
      conditions:
        - "Signal received from phase_3"
        - "Quality gate verification passed"
      policy_checks:
        - "$ref: LOGIC_16_POLICY_CAPTURE#enforcement_actions.validate_phase_entry"
        - "$ref: LOGIC_16_POLICY_CAPTURE#enforcement_actions.validate_external_communication"

    actions:
      - action_type: "invoke_tool"
        capability_key: "slack_messaging"
        params:
          channel: "#random"
          message_type: "workflow_overview"
          message_index: 1

      - action_type: "invoke_tool"
        capability_key: "slack_messaging"
        params:
          channel: "#random"
          message_type: "topic_content"
          message_index: 2
          topic: "TRENDS"

      - action_type: "invoke_tool"
        capability_key: "slack_messaging"
        params:
          channel: "#random"
          message_type: "topic_content"
          message_index: 3
          topic: "INDUSTRY"

      - action_type: "invoke_tool"
        capability_key: "slack_messaging"
        params:
          channel: "#random"
          message_type: "topic_content_with_wrapup"
          message_index: 4
          topic: "REGULATIONS"

    exit_gate:
      conditions:
        - "4 Slack messages delivered successfully"
        - "All content extracted from work_doc"
        - "Team credits included"
        - "Posting times provided"
      policy_checks:
        - "$ref: LOGIC_16_POLICY_CAPTURE#enforcement_actions.validate_delivery_complete"

    handoff:
      to: "workflow_complete"
      contract: "OPS_12_HANDOFF_CONTRACTS#workflow_completion"
      context_pass:
        - "trace_context"

# ═══════════════════════════════════════════════════════════════════════════════
# QUALITY GATES
# ═══════════════════════════════════════════════════════════════════════════════

quality_gates:
  base_ref: "$ref: LOGIC_08_QUALITY_GATES"

  workflow_specific:
    gate_phase_2_exit:
      trigger: "phase_2_complete signal received"
      verification:
        - "All 3 topics have complete strategic framing"
        - "Research items have evidence tier + source"
        - "No placeholder text in research/strategy sections"
      on_fail: "reject_and_request_completion"

    gate_phase_3_exit:
      trigger: "phase_3_complete signal received"
      verification:
        - "9 posts created with voice audits (all PASS)"
        - "9 images created with compliance checks"
        - "Alt text present for all images"
        - "Character limits verified"
        - "No placeholder text remains"
      on_fail: "reject_and_request_completion"

    gate_pre_slack_message:
      trigger: "before each send_message_slack"
      verification:
        - "All bracketed placeholders filled"
        - "Image URLs present"
        - "Message complete and coherent"
      on_fail: "halt_delivery_and_report"

# ═══════════════════════════════════════════════════════════════════════════════
# STRICT RULES
# ═══════════════════════════════════════════════════════════════════════════════

strict_rules:
  prohibitions:
    - "ORCHESTRATOR must NOT create content (copy, strategy, or visuals)"
    - "ORCHESTRATOR must NOT use compose_message or instant_messaging tools"
    - "ORCHESTRATOR must NOT interrupt role pairs during collaboration"
    - "ORCHESTRATOR must NOT post individual components—only complete structured messages"
    - "ORCHESTRATOR must NOT assume workflow continuation without explicit completion signal"

  requirements:
    - "Use paired-agent handoff for role pair transitions"
    - "Create exactly 1 shared work document"
    - "Let role pairs collaborate until completion"
    - "Monitor quality gates at phase transitions only when signaled"
    - "Compile all outputs into exactly 4 Slack messages"
    - "Wait for explicit completion signals before proceeding"

# ═══════════════════════════════════════════════════════════════════════════════
# TOOLS REQUIRED (Capability Keys)
# ═══════════════════════════════════════════════════════════════════════════════

tools_required:
  orchestrator:
    - "document_creation"
    - "paired_agent_handoff"
    - "slack_messaging"

  analyst:
    - "web_search"
    - "web_fetch"
    - "news_retrieval"

  copywriter:
    - "content_generation"
    - "voice_audit"

  designer:
    - "image_generation"
    - "accessibility_validation"

# ═══════════════════════════════════════════════════════════════════════════════
# SUCCESS CRITERIA
# ═══════════════════════════════════════════════════════════════════════════════

success_criteria:
  - "4 Slack messages delivered with complete content"
  - "All quality gates passed"
  - "Team credits acknowledged"
  - "Optimal posting times provided"
  - "Zero content created by ORCHESTRATOR directly"
  - "Role pairs successfully collaborated and self-delegated"

# ═══════════════════════════════════════════════════════════════════════════════
# FAILURE MODES
# ═══════════════════════════════════════════════════════════════════════════════

failure_modes:
  work_document_creation_fails:
    description: "Work document creation fails"
    action: "Report to user, cannot proceed"
    recovery: "manual_intervention"

  agents_never_signal_completion:
    description: "Role pair never signals completion"
    action: "Remain in waiting state"
    recovery: "manual_intervention"
    note: "Cannot autonomously retry or reschedule"

  work_document_incomplete:
    description: "Work document incomplete when signaled"
    action: "Reject and request completion via quality gate"
    recovery: "role_pair_retry"

  content_extraction_fails:
    description: "Content extraction from work_doc fails"
    action: "Halt Slack delivery, report to user"
    recovery: "manual_intervention"

# ═══════════════════════════════════════════════════════════════════════════════
# VALIDATION
# ═══════════════════════════════════════════════════════════════════════════════

validation:
  structural_rules:
    - "Each phase must define entry_gate and exit_gate with policy_checks"
    - "trace_context must be passed via handoff.context_pass for all non-terminal phases"
    - "All capability_keys must exist in LOGIC_10_TOOLS_CORE.capability_tool_mapping"
    - "All use_case_ids must exist in CONFIG.activation.use_cases_active"
